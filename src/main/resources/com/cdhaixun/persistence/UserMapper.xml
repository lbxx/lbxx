<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cdhaixun.persistence.UserMapper" >
  <resultMap id="BaseResultMap" type="com.cdhaixun.domain.User" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="typeId" property="typeid" jdbcType="INTEGER" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="sex" property="sex" jdbcType="INTEGER" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="nickname" property="nickname" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="registertime" property="registertime" jdbcType="DATE" />
    <result column="lastlogintime" property="lastlogintime" jdbcType="DATE" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="registType" property="registtype" jdbcType="INTEGER" />
    <result column="blance" property="blance" jdbcType="DECIMAL" />
    <result column="points" property="points" jdbcType="INTEGER" />
    <result column="birthday" property="birthday" jdbcType="DATE" />
    <result column="province" property="province" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
    <result column="area" property="area" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="idcard" property="idcard" jdbcType="VARCHAR" />
    <result column="img" property="img" jdbcType="VARCHAR" />
    <result column="qrCode" property="qrcode" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Base_Column_List" >
    id, typeId, password, mobile, sex, email, nickname, name, registertime, lastlogintime, 
    remark, registType, blance, points, birthday, province, city, area, address, idcard, 
    img, qrCode, state
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select 
    <include refid="Base_Column_List" />
    from user
    where id = #{id,jdbcType=INTEGER}
  </select>
  <select id="findUserList" resultType="com.cdhaixun.vo.UserVo" parameterType="map" >
    SELECT
        u.id,
        u.mobile mobile,
        u.`name` NAME,
        u.sex sex,
        s.`name` storeName,
        ut.typeName typeName,
        u.registertime registertime
        FROM
        `user` u
        LEFT JOIN store s ON u.storeId = s.id
        LEFT JOIN user_type ut ON ut.chainstoreid = s.id
        WHERE
        u.state = 1
    <if test="storeId != null and '' != storeId">
      AND u.storeId = #{storeId}
    </if>
    <if test="registertime != null and '' != registertime">
        AND DATE_FORMAT(registertime,'%Y-%m-%d') = DATE_FORMAT(registertime,#{registertime})
    </if>
    <if test="type != null and '' != type">
      <if test="type == 'idcard'">
        AND u.idcard LIKE '%${typeval}%'
      </if>
      <if test="type == 'name'">
        AND u.name LIKE '%${typeval}%'
      </if>
      <if test="type == 'mobile'">
        AND u.mobile LIKE '%${typeval}%'
      </if>
    </if>
  </select>
  <select id="selectStoreList" resultType="com.cdhaixun.domain.Store" >
    select * from store
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from user
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.cdhaixun.domain.User" >
    insert into user (id, typeId, password, 
      mobile, sex, email, 
      nickname, name, registertime, 
      lastlogintime, remark, registType, 
      blance, points, birthday, 
      province, city, area, 
      address, idcard, img, 
      qrCode, state)
    values (#{id,jdbcType=INTEGER}, #{typeid,jdbcType=INTEGER}, #{password,jdbcType=VARCHAR}, 
      #{mobile,jdbcType=VARCHAR}, #{sex,jdbcType=INTEGER}, #{email,jdbcType=VARCHAR}, 
      #{nickname,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{registertime,jdbcType=DATE}, 
      #{lastlogintime,jdbcType=DATE}, #{remark,jdbcType=VARCHAR}, #{registtype,jdbcType=INTEGER}, 
      #{blance,jdbcType=DECIMAL}, #{points,jdbcType=INTEGER}, #{birthday,jdbcType=DATE}, 
      #{province,jdbcType=VARCHAR}, #{city,jdbcType=VARCHAR}, #{area,jdbcType=VARCHAR}, 
      #{address,jdbcType=VARCHAR}, #{idcard,jdbcType=VARCHAR}, #{img,jdbcType=VARCHAR}, 
      #{qrcode,jdbcType=VARCHAR}, #{state,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.cdhaixun.domain.User" >
    update user
    <set >
      <if test="typeid != null" >
        typeId = #{typeid,jdbcType=INTEGER},
      </if>
      <if test="password != null" >
        password = #{password,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        sex = #{sex,jdbcType=INTEGER},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="nickname != null" >
        nickname = #{nickname,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="registertime != null" >
        registertime = #{registertime,jdbcType=DATE},
      </if>
      <if test="lastlogintime != null" >
        lastlogintime = #{lastlogintime,jdbcType=DATE},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="registtype != null" >
        registType = #{registtype,jdbcType=INTEGER},
      </if>
      <if test="blance != null" >
        blance = #{blance,jdbcType=DECIMAL},
      </if>
      <if test="points != null" >
        points = #{points,jdbcType=INTEGER},
      </if>
      <if test="birthday != null" >
        birthday = #{birthday,jdbcType=DATE},
      </if>
      <if test="province != null" >
        province = #{province,jdbcType=VARCHAR},
      </if>
      <if test="city != null" >
        city = #{city,jdbcType=VARCHAR},
      </if>
      <if test="area != null" >
        area = #{area,jdbcType=VARCHAR},
      </if>
      <if test="address != null" >
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="idcard != null" >
        idcard = #{idcard,jdbcType=VARCHAR},
      </if>
      <if test="img != null" >
        img = #{img,jdbcType=VARCHAR},
      </if>
      <if test="qrcode != null" >
        qrCode = #{qrcode,jdbcType=VARCHAR},
      </if>
      <if test="state != null" >
        state = #{state,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
</mapper>